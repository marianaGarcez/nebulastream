# name: sncb_brake
# description: Brake pressure check
# groups: [SNCB]

Source gps_data UINT64 device_id UINT64 timestamp FLOAT64 PCFA FLOAT64 PCFF FLOAT64 PCF1 FLOAT64 PCF2 FLOAT64 T1 FLOAT64 T2 UINT64 Code1 UINT64 Code2 INLINE
5,1726972591,3.0,3.860,3.082,3.018,38.68,3.606,0,1024
5,1726972592,3.2,3.865,3.082,3.018,38.75,3.618,0,1024
5,1726972593,3.5,3.862,3.082,3.026,38.68,3.6,0,1024
5,1726972594,3.3,3.864,3.082,3.026,38.75,3.6,0,1024
5,1726972595,3.1,3.861,3.082,3.026,38.75,3.6,0,1024
5,1726972596,3.4,3.863,3.082,3.026,38.75,3.6,0,1024


SINK brake_sink UINT64 GPS_DATA$START UINT64 GPS_DATA$END FLOAT64 GPS_DATA$PCFA_VAR FLOAT64 GPS_DATA$PCFF_VAR

SELECT gps_data$start, gps_data$end, PCFA_VAR, PCFF_VAR FROM (
    SELECT gps_data$start, gps_data$end, VAR(gps_data$PCFA) AS PCFA_VAR, VAR(gps_data$PCFF) AS PCFF_VAR 
    FROM gps_data
    WINDOW SLIDING(gps_data$timestamp, SIZE 10 SEC, ADVANCE BY 5 SEC)
) WHERE (PCFA_VAR > FLOAT64(0.4)) AND (PCFF_VAR <= FLOAT64(0.1))
INTO brake_sink;

----
1726965000,1726975000,0.5,0.005
1726970000,1726980000,0.5,0.005
